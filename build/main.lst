                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.2.0 #13081 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module main
                                      6 	.optsdcc -mstm8
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _main
                                     12 	.globl _write_color_to_eeprom
                                     13 	.globl _load_color_from_eeprom
                                     14 	.globl _smart_decrement
                                     15 	.globl _smart_increment
                                     16 	.globl _write_color_to_registers
                                     17 	.globl _tim2_init
                                     18 	.globl _btn_load_is_pressed
                                     19 	.globl _btn_b_minus_is_pressed
                                     20 	.globl _btn_g_minus_is_pressed
                                     21 	.globl _btn_r_minus_is_pressed
                                     22 	.globl _btn_b_plus_is_pressed
                                     23 	.globl _btn_g_plus_is_pressed
                                     24 	.globl _btn_r_plus_is_pressed
                                     25 	.globl _gpio_init
                                     26 	.globl _clk_init
                                     27 	.globl _rgb
                                     28 	.globl _button_hundler
                                     29 ;--------------------------------------------------------
                                     30 ; ram data
                                     31 ;--------------------------------------------------------
                                     32 	.area DATA
      000000                         33 _rgb::
      000000                         34 	.ds 3
                                     35 ;--------------------------------------------------------
                                     36 ; ram data
                                     37 ;--------------------------------------------------------
                                     38 	.area INITIALIZED
                                     39 ;--------------------------------------------------------
                                     40 ; Stack segment in internal ram
                                     41 ;--------------------------------------------------------
                                     42 	.area	SSEG
      000000                         43 __start__stack:
      000000                         44 	.ds	1
                                     45 
                                     46 ;--------------------------------------------------------
                                     47 ; absolute external ram data
                                     48 ;--------------------------------------------------------
                                     49 	.area DABS (ABS)
                                     50 
                                     51 ; default segment ordering for linker
                                     52 	.area HOME
                                     53 	.area GSINIT
                                     54 	.area GSFINAL
                                     55 	.area CONST
                                     56 	.area INITIALIZER
                                     57 	.area CODE
                                     58 
                                     59 ;--------------------------------------------------------
                                     60 ; interrupt vector
                                     61 ;--------------------------------------------------------
                                     62 	.area HOME
      000000                         63 __interrupt_vect:
      000000 82v00u00u00             64 	int s_GSINIT ; reset
                                     65 ;--------------------------------------------------------
                                     66 ; global & static initialisations
                                     67 ;--------------------------------------------------------
                                     68 	.area HOME
                                     69 	.area GSINIT
                                     70 	.area GSFINAL
                                     71 	.area GSINIT
      000000                         72 __sdcc_init_data:
                                     73 ; stm8_genXINIT() start
      000000 AEr00r00         [ 2]   74 	ldw x, #l_DATA
      000003 27 07            [ 1]   75 	jreq	00002$
      000005                         76 00001$:
      000005 72 4FuFFuFF      [ 1]   77 	clr (s_DATA - 1, x)
      000009 5A               [ 2]   78 	decw x
      00000A 26 F9            [ 1]   79 	jrne	00001$
      00000C                         80 00002$:
      00000C AEr00r00         [ 2]   81 	ldw	x, #l_INITIALIZER
      00000F 27 09            [ 1]   82 	jreq	00004$
      000011                         83 00003$:
      000011 D6uFFuFF         [ 1]   84 	ld	a, (s_INITIALIZER - 1, x)
      000014 D7uFFuFF         [ 1]   85 	ld	(s_INITIALIZED - 1, x), a
      000017 5A               [ 2]   86 	decw	x
      000018 26 F7            [ 1]   87 	jrne	00003$
      00001A                         88 00004$:
                                     89 ; stm8_genXINIT() end
                                     90 	.area GSFINAL
      000000 CCr00r04         [ 2]   91 	jp	__sdcc_program_startup
                                     92 ;--------------------------------------------------------
                                     93 ; Home
                                     94 ;--------------------------------------------------------
                                     95 	.area HOME
                                     96 	.area HOME
      000004                         97 __sdcc_program_startup:
      000004 CCr00r08         [ 2]   98 	jp	_main
                                     99 ;	return from main will return to caller
                                    100 ;--------------------------------------------------------
                                    101 ; code
                                    102 ;--------------------------------------------------------
                                    103 	.area CODE
                                    104 ;	main.c: 19: static void delay(uint16_t t) {
                                    105 ;	-----------------------------------------
                                    106 ;	 function delay
                                    107 ;	-----------------------------------------
      000000                        108 _delay:
                                    109 ;	main.c: 20: while(t--) {};
      000000                        110 00101$:
      000000 90 93            [ 1]  111 	ldw	y, x
      000002 5A               [ 2]  112 	decw	x
      000003 90 5D            [ 2]  113 	tnzw	y
      000005 26 F9            [ 1]  114 	jrne	00101$
                                    115 ;	main.c: 21: }
      000007 81               [ 4]  116 	ret
                                    117 ;	main.c: 25: int main() {
                                    118 ;	-----------------------------------------
                                    119 ;	 function main
                                    120 ;	-----------------------------------------
      000008                        121 _main:
                                    122 ;	main.c: 26: __asm sim __endasm; // Disable interrupts
      000008 9B               [ 1]  123 	sim	
                                    124 ;	main.c: 28: clk_init();
      000009 CDr00r00         [ 4]  125 	call	_clk_init
                                    126 ;	main.c: 29: gpio_init();
      00000C CDr00r00         [ 4]  127 	call	_gpio_init
                                    128 ;	main.c: 30: tim2_init();
      00000F CDr00r00         [ 4]  129 	call	_tim2_init
                                    130 ;	main.c: 36: __asm rim __endasm; // Enable interrupts
      000012 9A               [ 1]  131 	rim	
                                    132 ;	main.c: 40: rgb.r = 0;
      000013 35 00u00u00      [ 1]  133 	mov	_rgb+0, #0x00
                                    134 ;	main.c: 41: rgb.g = 0;
      000017 35 00u00u01      [ 1]  135 	mov	_rgb+1, #0x00
                                    136 ;	main.c: 42: rgb.b = 0;
      00001B 35 00u00u02      [ 1]  137 	mov	_rgb+2, #0x00
                                    138 ;	main.c: 48: load_color_from_eeprom(&rgb, 0);
      00001F 4F               [ 1]  139 	clr	a
      000020 AEr00r00         [ 2]  140 	ldw	x, #(_rgb+0)
      000023 CDr00r00         [ 4]  141 	call	_load_color_from_eeprom
                                    142 ;	main.c: 50: while(1) {
      000026                        143 00102$:
                                    144 ;	main.c: 51: button_hundler(&rgb);
      000026 AEr00r00         [ 2]  145 	ldw	x, #(_rgb+0)
      000029 CDr00r35         [ 4]  146 	call	_button_hundler
                                    147 ;	main.c: 52: write_color_to_registers(&rgb);
      00002C AEr00r00         [ 2]  148 	ldw	x, #(_rgb+0)
      00002F CDr00r00         [ 4]  149 	call	_write_color_to_registers
      000032 20 F2            [ 2]  150 	jra	00102$
                                    151 ;	main.c: 54: }
      000034 81               [ 4]  152 	ret
                                    153 ;	main.c: 56: void button_hundler(struct Color *color) {
                                    154 ;	-----------------------------------------
                                    155 ;	 function button_hundler
                                    156 ;	-----------------------------------------
      000035                        157 _button_hundler:
      000035 52 07            [ 2]  158 	sub	sp, #7
      000037 1F 06            [ 2]  159 	ldw	(0x06, sp), x
                                    160 ;	main.c: 57: if(btn_r_plus_is_pressed()) {
      000039 CDr00r00         [ 4]  161 	call	_btn_r_plus_is_pressed
      00003C 4D               [ 1]  162 	tnz	a
      00003D 27 05            [ 1]  163 	jreq	00102$
                                    164 ;	main.c: 58: smart_increment(&color->r);
      00003F 1E 06            [ 2]  165 	ldw	x, (0x06, sp)
      000041 CDr00r00         [ 4]  166 	call	_smart_increment
      000044                        167 00102$:
                                    168 ;	main.c: 61: if(btn_r_minus_is_pressed()) {
      000044 CDr00r00         [ 4]  169 	call	_btn_r_minus_is_pressed
      000047 4D               [ 1]  170 	tnz	a
      000048 27 05            [ 1]  171 	jreq	00104$
                                    172 ;	main.c: 62: smart_decrement(&color->r);
      00004A 1E 06            [ 2]  173 	ldw	x, (0x06, sp)
      00004C CDr00r00         [ 4]  174 	call	_smart_decrement
      00004F                        175 00104$:
                                    176 ;	main.c: 65: if(btn_g_plus_is_pressed()) {
      00004F CDr00r00         [ 4]  177 	call	_btn_g_plus_is_pressed
                                    178 ;	main.c: 66: smart_increment(&color->g);
      000052 1E 06            [ 2]  179 	ldw	x, (0x06, sp)
      000054 5C               [ 1]  180 	incw	x
                                    181 ;	main.c: 65: if(btn_g_plus_is_pressed()) {
      000055 4D               [ 1]  182 	tnz	a
      000056 27 05            [ 1]  183 	jreq	00106$
                                    184 ;	main.c: 66: smart_increment(&color->g);
      000058 89               [ 2]  185 	pushw	x
      000059 CDr00r00         [ 4]  186 	call	_smart_increment
      00005C 85               [ 2]  187 	popw	x
      00005D                        188 00106$:
                                    189 ;	main.c: 69: if(btn_g_minus_is_pressed()) {
      00005D 89               [ 2]  190 	pushw	x
      00005E CDr00r00         [ 4]  191 	call	_btn_g_minus_is_pressed
      000061 85               [ 2]  192 	popw	x
      000062 4D               [ 1]  193 	tnz	a
      000063 27 03            [ 1]  194 	jreq	00108$
                                    195 ;	main.c: 70: smart_decrement(&color->g);
      000065 CDr00r00         [ 4]  196 	call	_smart_decrement
      000068                        197 00108$:
                                    198 ;	main.c: 73: if(btn_b_plus_is_pressed()) {
      000068 CDr00r00         [ 4]  199 	call	_btn_b_plus_is_pressed
                                    200 ;	main.c: 74: smart_increment(&color->b);
      00006B 1E 06            [ 2]  201 	ldw	x, (0x06, sp)
      00006D 5C               [ 1]  202 	incw	x
      00006E 5C               [ 1]  203 	incw	x
                                    204 ;	main.c: 73: if(btn_b_plus_is_pressed()) {
      00006F 4D               [ 1]  205 	tnz	a
      000070 27 05            [ 1]  206 	jreq	00110$
                                    207 ;	main.c: 74: smart_increment(&color->b);
      000072 89               [ 2]  208 	pushw	x
      000073 CDr00r00         [ 4]  209 	call	_smart_increment
      000076 85               [ 2]  210 	popw	x
      000077                        211 00110$:
                                    212 ;	main.c: 77: if(btn_b_minus_is_pressed()) {
      000077 89               [ 2]  213 	pushw	x
      000078 CDr00r00         [ 4]  214 	call	_btn_b_minus_is_pressed
      00007B 85               [ 2]  215 	popw	x
      00007C 4D               [ 1]  216 	tnz	a
      00007D 27 03            [ 1]  217 	jreq	00112$
                                    218 ;	main.c: 78: smart_decrement(&color->b);
      00007F CDr00r00         [ 4]  219 	call	_smart_decrement
      000082                        220 00112$:
                                    221 ;	main.c: 88: if(btn_load_is_pressed()) {
      000082 CDr00r00         [ 4]  222 	call	_btn_load_is_pressed
      000085 6B 05            [ 1]  223 	ld	(0x05, sp), a
      000087 26 03            [ 1]  224 	jrne	00225$
      000089 CCr01r15         [ 2]  225 	jp	00132$
      00008C                        226 00225$:
                                    227 ;	main.c: 89: uint8_t counter = 0;
      00008C 0F 04            [ 1]  228 	clr	(0x04, sp)
                                    229 ;	main.c: 90: while(counter < 10 && btn_load_is_pressed()) {
      00008E                        230 00114$:
      00008E 7B 04            [ 1]  231 	ld	a, (0x04, sp)
      000090 A1 0A            [ 1]  232 	cp	a, #0x0a
      000092 24 0F            [ 1]  233 	jrnc	00116$
      000094 CDr00r00         [ 4]  234 	call	_btn_load_is_pressed
      000097 4D               [ 1]  235 	tnz	a
      000098 27 09            [ 1]  236 	jreq	00116$
                                    237 ;	main.c: 91: delay(65535);
      00009A 5F               [ 1]  238 	clrw	x
      00009B 5A               [ 2]  239 	decw	x
      00009C CDr00r00         [ 4]  240 	call	_delay
                                    241 ;	main.c: 92: counter += 1;
      00009F 0C 04            [ 1]  242 	inc	(0x04, sp)
      0000A1 20 EB            [ 2]  243 	jra	00114$
      0000A3                        244 00116$:
                                    245 ;	main.c: 96: load_color_from_eeprom(&rgb_buf, 0);        
      0000A3 4F               [ 1]  246 	clr	a
      0000A4 96               [ 1]  247 	ldw	x, sp
      0000A5 5C               [ 1]  248 	incw	x
      0000A6 CDr00r00         [ 4]  249 	call	_load_color_from_eeprom
                                    250 ;	main.c: 97: write_color_to_registers(&rgb_buf);
      0000A9 96               [ 1]  251 	ldw	x, sp
      0000AA 5C               [ 1]  252 	incw	x
      0000AB CDr00r00         [ 4]  253 	call	_write_color_to_registers
                                    254 ;	main.c: 98: delay(65535);
      0000AE 5F               [ 1]  255 	clrw	x
      0000AF 5A               [ 2]  256 	decw	x
      0000B0 CDr00r00         [ 4]  257 	call	_delay
                                    258 ;	main.c: 99: delay(65535);
      0000B3 5F               [ 1]  259 	clrw	x
      0000B4 5A               [ 2]  260 	decw	x
      0000B5 CDr00r00         [ 4]  261 	call	_delay
                                    262 ;	main.c: 100: delay(65535);
      0000B8 5F               [ 1]  263 	clrw	x
      0000B9 5A               [ 2]  264 	decw	x
      0000BA CDr00r00         [ 4]  265 	call	_delay
                                    266 ;	main.c: 103: while(counter < 23 && btn_load_is_pressed()) {
      0000BD                        267 00121$:
      0000BD 7B 04            [ 1]  268 	ld	a, (0x04, sp)
      0000BF A1 17            [ 1]  269 	cp	a, #0x17
      0000C1 4F               [ 1]  270 	clr	a
      0000C2 49               [ 1]  271 	rlc	a
      0000C3 6B 05            [ 1]  272 	ld	(0x05, sp), a
      0000C5 27 26            [ 1]  273 	jreq	00123$
      0000C7 CDr00r00         [ 4]  274 	call	_btn_load_is_pressed
      0000CA 4D               [ 1]  275 	tnz	a
      0000CB 27 20            [ 1]  276 	jreq	00123$
                                    277 ;	main.c: 104: delay(65535);
      0000CD 5F               [ 1]  278 	clrw	x
      0000CE 5A               [ 2]  279 	decw	x
      0000CF CDr00r00         [ 4]  280 	call	_delay
                                    281 ;	main.c: 105: delay(65535);
      0000D2 5F               [ 1]  282 	clrw	x
      0000D3 5A               [ 2]  283 	decw	x
      0000D4 CDr00r00         [ 4]  284 	call	_delay
                                    285 ;	main.c: 106: if (counter % 2 == 0) {
      0000D7 7B 04            [ 1]  286 	ld	a, (0x04, sp)
      0000D9 44               [ 1]  287 	srl	a
      0000DA 25 07            [ 1]  288 	jrc	00118$
                                    289 ;	main.c: 107: write_color_to_registers(&rgb_buf);
      0000DC 96               [ 1]  290 	ldw	x, sp
      0000DD 5C               [ 1]  291 	incw	x
      0000DE CDr00r00         [ 4]  292 	call	_write_color_to_registers
      0000E1 20 06            [ 2]  293 	jra	00119$
      0000E3                        294 00118$:
                                    295 ;	main.c: 110: write_color_to_registers(&rgb);
      0000E3 AEr00r00         [ 2]  296 	ldw	x, #(_rgb+0)
      0000E6 CDr00r00         [ 4]  297 	call	_write_color_to_registers
      0000E9                        298 00119$:
                                    299 ;	main.c: 112: counter += 1;
      0000E9 0C 04            [ 1]  300 	inc	(0x04, sp)
      0000EB 20 D0            [ 2]  301 	jra	00121$
      0000ED                        302 00123$:
                                    303 ;	main.c: 115: if(counter > 10 && counter < 23) {
      0000ED 7B 04            [ 1]  304 	ld	a, (0x04, sp)
      0000EF A1 0A            [ 1]  305 	cp	a, #0x0a
      0000F1 23 15            [ 2]  306 	jrule	00127$
      0000F3 0D 05            [ 1]  307 	tnz	(0x05, sp)
      0000F5 27 11            [ 1]  308 	jreq	00127$
                                    309 ;	main.c: 116: rgb = rgb_buf;
      0000F7 4B 03            [ 1]  310 	push	#0x03
      0000F9 4B 00            [ 1]  311 	push	#0x00
      0000FB 96               [ 1]  312 	ldw	x, sp
      0000FC 1C 00 03         [ 2]  313 	addw	x, #3
      0000FF 89               [ 2]  314 	pushw	x
      000100 AEr00r00         [ 2]  315 	ldw	x, #(_rgb+0)
      000103 CDr00r00         [ 4]  316 	call	___memcpy
      000106 20 0D            [ 2]  317 	jra	00132$
      000108                        318 00127$:
                                    319 ;	main.c: 118: else if (counter == 23) { 
      000108 7B 04            [ 1]  320 	ld	a, (0x04, sp)
      00010A A1 17            [ 1]  321 	cp	a, #0x17
      00010C 26 07            [ 1]  322 	jrne	00132$
                                    323 ;	main.c: 119: write_color_to_eeprom(&rgb, 0);        
      00010E 4F               [ 1]  324 	clr	a
      00010F AEr00r00         [ 2]  325 	ldw	x, #(_rgb+0)
      000112 CDr00r00         [ 4]  326 	call	_write_color_to_eeprom
      000115                        327 00132$:
                                    328 ;	main.c: 122: }
      000115 5B 07            [ 2]  329 	addw	sp, #7
      000117 81               [ 4]  330 	ret
                                    331 	.area CODE
                                    332 	.area CONST
                                    333 	.area INITIALIZER
                                    334 	.area CABS (ABS)
